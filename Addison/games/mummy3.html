<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Mummy’s Desert Escape — Run from the Sandstorm!</title>
<style>
:root{
  --paper:#faf3e1; --paper2:#f3e8cb; --ink:#2a1e11; --sub:#6f5a3b;
  --frame:#d6c79f; --card:#fffaf0; --accent:#bd8f2d;
  --stone:#e7d7b3; --stoneB:#c7b48b; --active:#d6bf8e; --activeB:#a88a4a;
  --done:#9fd0a7; --doneB:#2f905f;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;color:var(--ink);
  background:radial-gradient(1200px 700px at 10% -10%,#fff9e7,#f5ebcf 45%,#ecdfc1 100%),var(--paper);
  font-family:ui-sans-serif, system-ui, "Segoe UI", Inter, Helvetica, Arial, sans-serif;
  line-height:1.55; display:flex; align-items:center; justify-content:center; padding:18px;
}
.app{
  width:min(1100px,100%); background:linear-gradient(180deg,var(--card),var(--paper2));
  border:2px solid var(--frame); border-radius:18px; overflow:hidden;
  box-shadow:0 10px 36px rgba(0,0,0,.16), inset 0 0 0 1px rgba(255,255,255,.55);
}
header{
  display:flex; justify-content:space-between; align-items:center; gap:12px;
  padding:14px 18px; border-bottom:2px solid var(--frame);
  background:linear-gradient(180deg,#fff5d8,#f4ebd0);
}
.logo{display:flex; align-items:center; gap:12px; font-weight:800}
.logo svg{width:44px;height:44px}
.subtitle{font-size:12px; color:var(--sub)}
.hud{display:flex; gap:10px; flex-wrap:wrap}
.pill{background:#fffdf5;border:1px solid var(--frame);border-radius:999px;padding:6px 11px;font-size:14px}
main{padding:16px}

/* Board */
.board{background:#fffef7; border:1px solid var(--frame); border-radius:14px; padding:10px;}
.mapWrap{position:relative; width:100%; aspect-ratio:16/9; border:1px dashed #e3d5b6; border-radius:12px;
  background:linear-gradient(180deg, #fff7de 0%, #f6e6bf 65%, #efd6a4 100%);}
svg.map{width:100%; height:100%; display:block}

/* Tokens */
.mummy, .storm{position:absolute; width:64px; height:64px; pointer-events:none;}
@keyframes bounce { 0%,100%{ transform:translateY(0);} 50%{ transform:translateY(-4px);} }
.bounce{ animation:bounce .45s infinite ease-in-out; }
.stormFilter{ filter:blur(2px) contrast(1.1); opacity:.9; }
.puff{position:absolute; width:22px; height:22px; background:rgba(184,160,120,.45);
  border-radius:50%; filter:blur(2px); pointer-events:none; animation:puff .7s forwards ease-out;}
@keyframes puff{ 0%{ transform:scale(1); opacity:1;} 100%{ transform:scale(4); opacity:0;} }
.glow{position:absolute; width:80px; height:80px; border-radius:50%;
  box-shadow:0 0 26px 14px rgba(255,215,90,.65); animation:glowfade 1.4s forwards;}
@keyframes glowfade{ 0%{opacity:1;} 100%{opacity:0;} }

/* Quiz */
.card{background:#fffef7;border:1px solid var(--frame);border-radius:14px;padding:16px;margin-top:12px}
.prompt{font-weight:900; font-size:22px; margin:.45em 0 .2em}
.choices{display:grid; gap:10px; margin-top:8px}
@media (min-width:720px){ .choices{ grid-template-columns:1fr 1fr } }
.choice{ cursor:pointer; padding:12px 14px; border-radius:12px; background:#fffef9; border:1px solid var(--frame); transition:.15s }
.choice:hover{ transform:translateY(-1px); box-shadow:0 2px 0 #eadbbb }
.choice.correct{ background:#eef8f1; border-color:#2f905f; color:#14492b }
.choice.wrong{ background:#fdecec; border-color:#c96262; color:#6b1f1f }
.fact{ margin-top:8px; background:#fff6d8; border:1px solid #e5cf8d; padding:10px; border-radius:10px; color:#5a4522; font-size:14px; display:none }
.foot{display:flex; align-items:center; justify-content:space-between; margin-top:10px; color:var(--sub); font-size:14px}
button{ background:linear-gradient(180deg,#f3d186,#e0bb67); color:#352400; border:1px solid #a9822d; border-radius:10px; font-weight:800; padding:8px 12px; cursor:pointer }
.hidden{ display:none !important }
.end{ text-align:center; padding:30px 16px }
details summary{ cursor:pointer }
</style>
</head>
<body>
<div class="app">
  <header>
    <div class="logo">
      <svg viewBox="0 0 64 64"><rect x="10" y="12" width="44" height="40" rx="6" fill="#f5e7c7" stroke="#bfa06c" stroke-width="2"/><path d="M16 20h32M16 28h32M16 36h26M16 44h18" stroke="#b78f55" stroke-width="2"/></svg>
      <div>
        <div>Mummy’s Desert Escape</div>
        <div class="subtitle">Run to the Sun Gate before the sandstorm catches you!</div>
      </div>
    </div>
    <div class="hud" aria-live="polite">
      <div class="pill">Step <strong id="stepNum">1</strong>/12</div>
      <div class="pill">Storm Distance: <strong id="gap">Safe</strong></div>
    </div>
  </header>

  <main>
    <div class="board">
      <div class="mapWrap">
        <!-- DESERT SVG BACKDROP -->
        <svg class="map" viewBox="0 0 1200 675" preserveAspectRatio="none" aria-hidden="true">
          <!-- Sun -->
          <circle cx="1040" cy="90" r="60" fill="#ffd56b" opacity=".9"/>
          <circle cx="1040" cy="90" r="90" fill="#ffd56b" opacity=".25"/>
          <!-- Pyramids -->
          <g opacity=".9">
            <path d="M200 520 L320 640 L80 640 Z" fill="#d6b067" stroke="#b08a4d" stroke-width="3"/>
            <path d="M380 500 L520 640 L240 640 Z" fill="#dab56f" stroke="#b08a4d" stroke-width="3"/>
          </g>
          <!-- Palms -->
          <g opacity=".9">
            <rect x="960" y="510" width="12" height="70" fill="#9a6a2e" />
            <path d="M966 500 c 40 -40 80 -10 0 0 M966 500 c -40 -40 -80 -10 0 0 M966 500 c 40 -10 80 20 0 0 M966 500 c -40 -10 -80 20 0 0" stroke="#4a8f4a" stroke-width="8" fill="none" />
          </g>
          <!-- Curved path we follow (invisible stroke) -->
          <path id="travelPath"
            d="M80,610
               C 220,560 320,540 380,520
               C 520,470 600,440 640,380
               C 690,310 650,260 580,240
               C 520,225 470,220 430,200
               C 360,165 360,120 440,110
               C 560,95 700,150 820,200
               C 930,245 1020,300 1040,380
               C 1060,460 1000,520 900,560
               C 800,600 680,620 560,635
               C 420,650 260,645 160,630"
            fill="none" stroke="transparent" stroke-width="4"/>
          <!-- Stones (12 positions) -->
          <g id="stones"></g>
          <!-- Labels -->
          <g font-family="Georgia,serif" font-weight="700" fill="#6b5431">
            <text x="80" y="640" font-size="28">START</text>
            <text x="940" y="585" font-size="28">SUN GATE</text>
          </g>
        </svg>

        <!-- Mummy token -->
        <svg id="mummy" class="mummy" viewBox="0 0 64 64" aria-label="Mummy">
          <ellipse cx="32" cy="40" rx="14" ry="12" fill="#f7f0dc" stroke="#c9b89a" stroke-width="2"/>
          <circle cx="32" cy="25" r="10" fill="#f7f0dc" stroke="#c9b89a" stroke-width="2"/>
          <path d="M22 23h20M20 27h24M22 31h20M20 36h24M22 41h20" stroke="#d8cdb4" stroke-width="3"/>
          <circle cx="28" cy="23" r="2.6" fill="#3e2d16"/><circle cx="36" cy="23" r="2.6" fill="#3e2d16"/>
          <path d="M28 28 Q32 31 36 28" stroke="#3e2d16" stroke-width="2" fill="none"/>
        </svg>

        <!-- Sandstorm chaser -->
        <svg id="storm" class="storm stormFilter" viewBox="0 0 64 64" aria-label="Sandstorm">
          <defs>
            <linearGradient id="sand" x1="0" x2="1">
              <stop offset="0" stop-color="#e8d1a3"/>
              <stop offset="1" stop-color="#d7bc86"/>
            </linearGradient>
          </defs>
          <g opacity=".9">
            <ellipse cx="32" cy="36" rx="20" ry="12" fill="url(#sand)"/>
            <ellipse cx="28" cy="30" rx="16" ry="10" fill="url(#sand)"/>
            <ellipse cx="36" cy="26" rx="14" ry="8" fill="url(#sand)"/>
            <ellipse cx="32" cy="22" rx="12" ry="6" fill="url(#sand)"/>
          </g>
        </svg>
      </div>
    </div>

    <div class="card" id="quizCard">
      <h2 class="prompt" id="prompt">Loading…</h2>
      <div class="choices" id="choices"></div>
      <div id="fact" class="fact"></div>
      <div class="foot">
        <span>✅ Correct = run forward • ❌ Wrong = storm surges</span>
        <button id="nextBtn" class="hidden">Next</button>
      </div>
    </div>

    <div class="end hidden" id="end">
      <h2 id="endTitle"></h2>
      <p id="endMsg"></p>
      <button onclick="start()">Play Again</button>
    </div>

    <details style="margin-top:10px">
      <summary>Answer Key (teacher)</summary>
      <ol id="answerKey"></ol>
    </details>
  </main>
</div>

<script>
/* ---------- Sound ---------- */
const AC = window.AudioContext || window.webkitAudioContext;
let actx=null; function audio(){ if(!actx) actx=new AC(); }
function tone(f=880,d=.14,t="sine",g=.05){ if(!actx) return; const o=actx.createOscillator(), G=actx.createGain();
  o.type=t; o.frequency.value=f; G.gain.value=g; o.connect(G); G.connect(actx.destination); o.start(); o.stop(actx.currentTime+d); }
function chime(){ tone(1046,.12); setTimeout(()=>tone(1318,.12),100); }
function thud(){ tone(120,.22,"triangle",.07); }
function step(){ tone(320,.05,"square",.03); }

/* ---------- Elements ---------- */
const pathEl = document.getElementById('travelPath');
const stonesEl = document.getElementById('stones');
const mummy = document.getElementById('mummy');
const storm = document.getElementById('storm');
const stepNum = document.getElementById('stepNum');
const gapEl = document.getElementById('gap');
const promptEl = document.getElementById('prompt');
const choicesEl = document.getElementById('choices');
const factEl = document.getElementById('fact');
const nextBtn = document.getElementById('nextBtn');
const endView = document.getElementById('end');
const endTitle = document.getElementById('endTitle');
const endMsg = document.getElementById('endMsg');
const answerKey = document.getElementById('answerKey');

/* ---------- Data ---------- */
const STEPS = 12;              // spaces on the path
const MOVE_MS = 1000;          // animation duration per move
const stormPenalty = 1;        // storm moves +1 on wrong
const facts = {
  "Khufu (Cheops)":"The Great Pyramid stood as the world’s tallest structure for ~3,800 years.",
  "Imhotep":"Imhotep designed Djoser’s Step Pyramid and was later worshiped as a wise healer.",
  "Amon-Re":"Amon-Re combined the god Amon with the sun god Re — a powerful state deity.",
  "Anubis":"Priests wore jackal masks during mummification rituals to honor Anubis.",
  "Osiris":"Osiris ruled the underworld and symbolized rebirth along the Nile.",
  "Giza":"The Giza Plateau holds the Great Pyramid and the Great Sphinx.",
  "Hatshepsut":"Hatshepsut traded with Punt, bringing back incense, gold, and exotic trees.",
  "Narmer (Menes)":"The Narmer Palette shows the unification of Upper and Lower Egypt.",
  "Mummification":"It took about 70 days and included drying the body with natron salts.",
  "The Great Sphinx":"The Sphinx has a lion’s body and a human head—likely Khafre’s."
};
const BANK = [
  {q:"Which pharaoh was a female ruler who focused on trade instead of war?", c:["Hatshepsut","Nefertiti","Cleopatra VII","Sobekneferu"], a:0},
  {q:"Who was the young king whose tomb was found mostly untouched?", c:["Akhenaten","Tutankhamun","Khufu","Djoser"], a:1},
  {q:"Which pharaoh built the Great Pyramid at Giza?", c:["Khufu (Cheops)","Sneferu","Pepi II","Ramses II"], a:0},
  {q:"Who was known as Egypt’s first great engineer, helping design early pyramids?", c:["Imhotep","Amenhotep III","Thutmose III","Narmer"], a:0},
  {q:"Who expanded Egypt’s empire through conquest and war?", c:["Thutmose III","Narmer","Djoser","Pepi II"], a:0},
  {q:"What did Amon-Re represent to the Egyptians?", c:["The Sun","The Nile","War","Writing"], a:0},
  {q:"What was Osiris the god of?", c:["The Underworld and rebirth","The desert","The sky","Crafts"], a:0},
  {q:"Which god was believed to weigh people’s hearts after they died?", c:["Anubis","Horus","Ra","Ptah"], a:0},
  {q:"What animal was sacred to Anubis?", c:["Jackal","Cat","Ibis","Crocodile"], a:0},
  {q:"Every pharaoh was thought to be which god in human form?", c:["Horus","Set","Thoth","Ra"], a:0},
  {q:"What city is home to the Great Pyramid?", c:["Giza","Memphis","Thebes","Saqqara"], a:0},
  {q:"When a pharaoh died, what process preserved the body before burial?", c:["Mummification","Cremation","Freezing","Cloning"], a:0},
  {q:"Which ruler was first to unite Upper and Lower Egypt?", c:["Narmer (Menes)","Ramses II","Thutmose III","Khufu"], a:0},
  {q:"What structure stands in front of the Pyramid of Khafre?", c:["The Great Sphinx","An obelisk","A lighthouse","A ziggurat"], a:0},
];

function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]];} return a; }
let order=[], iStep=0, stormStep=-2, score=0; // storm starts 2 behind start

/* ---------- Geometry helpers ---------- */
function pathLen(){ return pathEl.getTotalLength(); }
function pointAt(len){ return pathEl.getPointAtLength(len); }
function stepPoint(step){ // step: 0..STEPS-1 (stones)
  const L = pathLen();
  const seg = L * (step / (STEPS-1));
  return pointAt(seg);
}
function drawStones(){
  stonesEl.innerHTML = '';
  for(let s=0;s<STEPS;s++){
    const p = stepPoint(s);
    const g = document.createElementNS('http://www.w3.org/2000/svg','g');
    const c = document.createElementNS('http://www.w3.org/2000/svg','circle');
    c.setAttribute('cx', p.x); c.setAttribute('cy', p.y); c.setAttribute('r', 18);
    c.setAttribute('fill', s===0 ? getCSS('--active') : getCSS('--stone'));
    c.setAttribute('stroke', s===0 ? getCSS('--activeB') : getCSS('--stoneB')); c.setAttribute('stroke-width','3');
    const t = document.createElementNS('http://www.w3.org/2000/svg','text');
    t.setAttribute('x', p.x); t.setAttribute('y', p.y+6);
    t.setAttribute('text-anchor','middle'); t.setAttribute('font-family','Georgia,serif');
    t.setAttribute('font-weight','700'); t.setAttribute('fill','#6b5431'); t.setAttribute('font-size','16'); t.textContent = s+1;
    g.appendChild(c); g.appendChild(t); stonesEl.appendChild(g);
  }
}
function getCSS(v){ return getComputedStyle(document.documentElement).getPropertyValue(v); }
function placeToken(el, step, yOffset=60){
  const wrap = document.querySelector('.mapWrap').getBoundingClientRect();
  const p = stepPoint(step);
  const x = (p.x/1200)*wrap.width - (el.getBBox ? el.getBBox().width/2 : 32);
  const y = (p.y/675)*wrap.height - yOffset;
  el.style.transform = `translate(${x}px,${y}px)`;
}

/* ---------- Animation ---------- */
function animateAlong(el, fromStep, toStep, cb){
  const wrap = document.querySelector('.mapWrap').getBoundingClientRect();
  const L = pathLen();
  const start = L * (fromStep/(STEPS-1));
  const end = L * (toStep/(STEPS-1));
  let t0=null;
  function frame(t){
    if(!t0) t0=t;
    const p = Math.min((t - t0)/MOVE_MS, 1);
    const len = start + (end - start)*p;
    const pt = pointAt(len);
    const x = (pt.x/1200)*wrap.width - 32;
    const y = (pt.y/675)*wrap.height - 60;
    el.style.transform = `translate(${x}px,${y}px)`;
    if(p<1) requestAnimationFrame(frame); else cb && cb();
  }
  requestAnimationFrame(frame);
}
function dustPuffAt(el){
  const r = el.getBoundingClientRect();
  const p = document.createElement('div'); p.className='puff';
  p.style.left = (r.left + r.width/2 - 10)+'px';
  p.style.top  = (r.top  + r.height - 5)+'px';
  document.body.appendChild(p);
  setTimeout(()=>p.remove(), 700);
}

/* ---------- Quiz ---------- */
function fillAnswerKey(){
  answerKey.innerHTML='';
  order.forEach(q=>{
    const li=document.createElement('li');
    li.textContent = `${q.q} — ${q.c[q.a]}`;
    answerKey.appendChild(li);
  });
}
function ask(){
  audio();
  stepNum.textContent = iStep+1;
  gapEl.textContent = (iStep - stormStep) >= 2 ? "Safe" : (iStep - stormStep === 1 ? "Close!" : "Danger!");
  const q = order[iStep];
  promptEl.textContent = q.q;
  choicesEl.innerHTML = ''; factEl.style.display='none';
  const choices = q.c.map((text, idx)=>({text, idx})); shuffle(choices).forEach(({text, idx})=>{
    const b = document.createElement('button'); b.className='choice'; b.textContent = text;
    b.onclick = ()=> check(idx, b, q);
    choicesEl.appendChild(b);
  });
  nextBtn.classList.add('hidden');
}
function check(sel, btn, q){
  const ok = sel === q.a;
  document.querySelectorAll('.choice').forEach(b=>b.disabled=true);
  if(ok){
    btn.classList.add('correct'); score++; chime();
    const correctText = q.c[q.a];
    const nugget = facts[correctText] || "Nice! Keep going toward the Sun Gate.";
    factEl.innerHTML = `📜 <strong>Did you know?</strong> ${nugget}`;
    factEl.style.display = 'block';
    // animate mummy forward one step
    mummy.classList.add('bounce'); step(); dustPuffAt(mummy);
    animateAlong(mummy, iStep, iStep+1, ()=>{
      mummy.classList.remove('bounce');
      colorStones(); // mark progress
      nextBtn.classList.remove('hidden');
      if(iStep+1 >= STEPS){ victory(); }
    });
  }else{
    btn.classList.add('wrong'); thud();
    // storm surges forward
    const target = Math.min(STEPS-1, stormStep + stormPenalty);
    animateAlong(storm, stormStep, target, ()=>{
      stormStep = target;
      colorStones();
      // caught?
      if(stormStep >= iStep){
        gameOver();
      }else{
        nextBtn.classList.remove('hidden');
      }
    });
  }
}
function colorStones(){
  const circles = stonesEl.querySelectorAll('circle');
  circles.forEach((c, s)=>{
    if(s < iStep){ c.setAttribute('fill', getCSS('--done')); c.setAttribute('stroke', getCSS('--doneB')); }
    else if(s === iStep){ c.setAttribute('fill', getCSS('--active')); c.setAttribute('stroke', getCSS('--activeB')); }
    else { c.setAttribute('fill', getCSS('--stone')); c.setAttribute('stroke', getCSS('--stoneB')); }
  });
}
nextBtn.addEventListener('click', ()=>{
  iStep++;
  if(iStep >= STEPS){ victory(); return; }
  ask();
});

/* ---------- End States ---------- */
function victory(){
  // glow celebration
  chime(); setTimeout(chime, 140);
  const g=document.createElement('div'); g.className='glow';
  const r=mummy.getBoundingClientRect(); g.style.left=(r.left+r.width/2-40)+'px'; g.style.top=(r.top+r.height/2-40)+'px';
  document.body.appendChild(g); setTimeout(()=>g.remove(), 1400);
  document.getElementById('quizCard').classList.add('hidden');
  endView.classList.remove('hidden');
  endTitle.textContent = "You reached the Sun Gate! ✨";
  endMsg.textContent = `Score: ${score}/${STEPS}. The afterlife breeze greets our speedy mummy.`;
}
function gameOver(){
  document.getElementById('quizCard').classList.add('hidden');
  endView.classList.remove('hidden');
  endTitle.textContent = "Caught by the Sandstorm! 🌪️";
  endMsg.textContent = "Try again—read each clue and outrun the storm!";
}

/* ---------- Start ---------- */
function start(){
  // order 12 questions
  order = shuffle([...BANK]).slice(0, STEPS);
  iStep = 0; stormStep = -2; score = 0;
  document.getElementById('quizCard').classList.remove('hidden');
  endView.classList.add('hidden');
  drawStones();
  placeToken(mummy, 0);
  placeToken(storm, Math.max(-2, 0), 50); // off to the left, follows path geometry
  colorStones();
  fillAnswerKey();
  ask();
}
document.body.addEventListener('click', audio, {once:true});
window.addEventListener('resize', ()=>{ placeToken(mummy, iStep); placeToken(storm, stormStep, 50); });
setTimeout(start, 60);
</script>
</body>
</html>
